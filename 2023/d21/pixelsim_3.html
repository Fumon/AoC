<!DOCTYPE html>
<html>

<head>
    <title>Pixel Expansion with Constraints</title>
    <style>
        canvas {
            border: 1px solid black;
        }
    </style>
</head>

<body>
    <canvas id="myCanvas" width="1179" height="1179"></canvas>
    <button id="expandButton">Expand</button>
    <span id="stepnum">0</span>

    <script>
        const canvas = document.getElementById('myCanvas');
        const ctx = canvas.getContext('2d');
        const stepcounttext = document.getElementById('stepnum');
        let stepnum = 0;

        const size = 1179;
        const mid = Math.floor(size / 2);
        let pixels = new Set();

        // The string representing the grid
        const gridString = `...................................................................................................................................
......#...........#................#......................................#.....#......#..##.#.......#....#.#........#...##...#....
...........#.................##...#...##......#............#...........##..#....................#.................#......#....#..#.
.....#.........#.....#.#.....###........###........#..........................##..##.......#.......#.....#...............#.......#.
....#..#......#......................#......#...............................#...........#........................#.............#...
.......#.....................#.............#......#...............#....................#............#.#.........#..#...............
.#.#.....#....#...................##......#..#..................#............................................#...............#.....
.....#....#...#....##...#......#.............#......##........#................#................#................#...............#.
.......#...................#..........#......................................#.........................##.........#..#.#..#........
....#..........#.........#....#......##...........##.................#................#...#............#...#..##....#...........#..
...#..........###............#.............#........................##..................#...##..................##......#...#......
.......#.......#.#..#.......#.......##..........#.........#..............................##.....#..#..........#.....#......#.......
..#.........#.....#..#..#..#..................#.........................#......................#.#..#...#..........#.....#....##.#.
..................................#.....#................#........#..........................#........#.....#...............#....#.
..........#..........#.#.................#.#.........................................#.......#..........#..##...#......#...........
.........#........#...........#...#.#....#.................##..#....................#..........#....#.#....##........#.......#.....
....#........#....................##..#......................#......#.........................#..#............................#....
...#.#...#...#......................#..#..........................#...#.#...............#......#.#........#....#..........#.....#..
..............#.....#.#......#........#...#..........#..#.#..#.........................#.....#..#......#.......#......#.......#....
.......................#.....#.....#................................##...#..#...#...........#..#..........#..#.#...#.........#...#.
.........#........#......#..#................................#.##.........#...#.................##......#.........#.##...#...#.....
.#.#.........##....#..........#..##.....................#..##...#..#..#...#.......#...........................#....................
.#.#......#..#..............##.#...#.#.............#.........#..............#.....#...............#..........................#...#.
.....##.....#.....##..#...#..#..#......................................#......#.............#.............#.....#......#........#..
......................#........#................#.......#..........#.............##............#..........#....#............#......
.....#..............................#.......##......#..#....#..............#.....................................#.....#.........#.
....................##...........#................#.#.....#.............#......#..##...#....................#................#.#...
.................................#...........#.....#..#..#..............#..##.........#..............#......#................#.....
............##.................................#..#...##.#........#...................................#...........#.#........#...#.
...#.......#.#........#......#...........#....#..#.......#....#........#.#.#.............##.......#.................#..............
...###............#......................##..##.........................#.........#......#..............#..#............#..........
..#.......#...##...#..#.......#.......#...#...........................................#...................#........##....#..#......
..#..................#.....#...........#.................#.#.#...........#..................#............#.......#.................
...##..#.............#.....#.....................#................#..........................#.............##...............#......
............#....#....#...#............#....#...........#.#.................#....#..................................#..............
...#.....#.............#...........................#.....##..........#...............#....#...............#........................
......#.....##.........#..........##..#...............#....#..#.#.#.....#.............#.###..............#..#......................
....................#...#...............#....................#...............#.#.#..##.............................#...............
...................#...#...........#...#.#...#...........#..............#............#..#......#............#.............#......#.
...#................#.................#.....#..........#........#.#........#...................#..#...........#.##........#......#.
....................#..........#....................#....#...#.....................#.......#.................#......#........#.....
...#.........#...................#.......##...###......#..#.......#.#..................#............#...........#....#...........#.
......#..#.#...#.#...............#.......................#.........#.......##................#...................#.###.............
...............#..............................................#.....#....#...#..#...#.....#......#.....#...........................
.......#.......#..........#.#.#..#.....#...#......#.................#........#...#..#.#.......#....................................
...........#..#.....................#.........................#...#.#.....#..........#....##.....#.................................
.......#.#.#.#..........#...#.##.##..#....................#.#.#..............#...................#....##...........................
.........................#.#.#...................#......#......#.............#.....#..............#......###..............#.#......
......#...............#...........#...................##..............#.##..#.#.#.#.#......#.....#.##.......#............#.#....##.
.....#....#.............#..##........###...#.......#.....#....#.......###....................#..#.#............................#...
.#........................#.....#......#.#.....................#......#.#...........#..#.....#.#.#..........#..............#...#...
.....##...#.........#.#.#.#...................#..#..#.#..#...#..#.....#.#.....#.........##.........................................
.................#.#...............#...............#...........#...........#.....#..........#...#.............................#....
.......................##...........#..........#...............#..#......................................#...#................#..#.
......#......................#..##.#........#.............#.....#..#....................#......#.........#.....#...#...........#.#.
.....................#.................#....##..#....#....##..#..............#..............#.....#...............#................
.#.................##.....#.#....#.....................#.............#....#......#...................#.#.##....................#...
.##..........##....#.##......#..#.................#...#..##........#....#..#.......#..............#.......#........................
......................#...........###.#.....##.............##........#..................#..............................#........#..
..#........................#...................#.#.#...#........#........#....#.....#.....#........................#...............
.#...........................#........#.....................#.....##.#..#.....#......#....#...#............##......................
............#...#..#..........#..............#...#...#..#..........#.........#...............#....#.#......#.#...#.................
..............................#..##...............#.....#....#.........................#....#...#....#.....#....#..................
..................#.#.........................#.......#........#.......#..##....#...#....#..................................#......
..........................#..#...#....................................#......#...#...#..#...#....#.............#.#.................
...................................................................................................................................
..............#...#...#.....##....#..................#....#........##..#.....#.#...#.#..............#.................##...........
.........##.........#............##.............................#.#...#.#.......#..........####....#...........#...........#.......
.........#...............................#...............#........................#......#..#......#.............##................
.............#..............................#...#.................#..........###.#.#.#.........#........#..........................
.#........#..#...........##...........#.#..........................#.........#....#.............#.............##...................
..#..........#..........................#...#..#..#.##...#..............#.....#...#............##........#.#.......#............#..
.................#.........#.......#.......#............#.#.................##...#.##.....................#.....#..................
.#.##..........#...#...................#...#.....##.....#...............#..#.........#..............#.................#............
.....#.......#..##....#..........#........#.#.....#.........#...............##......#.#....#.....#.................#...............
......#.......#.#...#....................#...............#.........#....#..#.#..........##.....#...#........................#......
.#.................#.................#.#....................#..............#.................#......#.......#.....#................
.#..#................................#......#..........#..............#.#.##.......................#...............................
..#.#............#.#......#...............#.#....#...#.#..#.......#...#.....#.......#........#.#...........#...#............##.....
.......#..........#....#....................#................##...........#......#..#...#....#...#......................#...#.#....
.........##........#........#......#.......#........#..#................#..#.............#..................#.#..........#.........
......#....#.................................#..#.#....#..............#........#.....#.##........#..........#.............#....#...
.............#........#.........#...##.....#.....#................##..........#.......#....#.......................................
..........................#.....#..#......#....#....#..##...#.......................#..............#.......#..........#..#......#..
...#.......................#....#.......#......#..................#................#...##........##.#............................#.
....#....................#.####..........#......#.....#......#....#.#.#................#...#..............#.............#.....#....
..........#..#...#..............##..#..#..#..........#.......#.##........##..............#.....#......#............#...#...........
..........................#..#..............#..#....#..#..............#.#...#..........#.....#..#.#................................
.......#.......#...............#.........#..#.#...#.....................#.....#......................#..............#.#..#.........
........#.....#.............#....................#.#........#.................#.....#...#..........#............#...............#..
.............#....##.........#.#................#....#.........#...#.......................#.....#.#..................#......#.....
...............#.....#.............#.....#.......#.......#......#.#..#.....#...#...#.......#................#...#................#.
...................#..#...........#..###....................#......#........#......#...........................#......#.......#....
..#.....#.##......#................#.................#.................##....................#.#...........#....#.#...#........#...
....#......#.#..#........#..............#.......#.........#.................#.............#.#...#...........#.#................#...
..#....#.#.......#...#.................#......#....#................#.......................#...#.........##..........#.........#..
..............#...............................#.##..............................#.......#..#...#...................#...#........#..
.#..#....#......#.....#...#............#..............................#..............#....................#..##..............#..##.
.......##............#..#............######............#................#..........#.#...#...#................#....................
...#..................##....................#.......#.#....##...................##..#....#..#..........#.....#.....................
...#.....#..#..#.#.......................#......................#...........#......###...#.............#........................#..
.....#.............#..........#......................#....#............#.##....#.......#.............#..........#........##........
........#...#.#..................#........#.#......#........#.....##...#...#....#...#......................................#.......
...............#............#..#.......................##.#.....#...#.#........#..................#......#.........................
.............##..#.......#.#.....#............#............#..........##.......#.....##...............................#...#........
.#..##...............#..............#...........#..#..#...##.......#..#.......................#.......##.....................#.#...
.....................###........#..#.....................#........#...#.##...................#....##.........#.........#...........
...#.....#...............#....#..###.......................................#..................#....................................
...#.#.#.....#..#.........#.....#...##.............#................#......#.....#........................#....#..............#....
...........#......#..##.......#......#..................#.....##..................#........#.......#......#...#...#..#...#.........
.........#.#.........#......#............................#.....#............#.................#..........#..............#.......#..
............#.........#.#....#.......#...................................#..............##.##..............#....#...............#..
.............#.....##.........#.........##...............#...............#.............................###........#.....#.#........
......##..........#....#.#.#..........##.#.#................#...#....##.......................#.......#...#.#........#.#..#........
....#....#............#.#......#..#.........#.............#.#..........................#.......#..............#..#..#.....#........
...................#...........#....#...#..#..#.......#..#...#.#........................#.................#.............#..........
.........#..#...#......#......#......#.................#...........#...................#........#.......#......#.#.......#.......#.
..#..#......#.....................#...........................#.....##................#.............................#..............
..#.#.......#........................#.......#..........................#................#.....#...#.........#.#......#............
...............................#....................................#.......................##....#......#.#.........#.#.........#.
.#.....................#......#..........#......#..............#...............##............#...#.##...#......##...#.#.#..........
...............#.#......#..................#......................................................#........................#.#.....
...#...#..#...............##...#...#.....#...#....................#..#..........#.....##......................................#....
.#..#...#........................#....#...##......#...........#.......................#...##......#.......#................#.......
....#...........#.............#.....#..#..#.....#.................................#........#.#..............#......................
....#....#........#..#.#..............#................................................#..............#................#.........#.
.....#..........#.......#..................#................................................#..............##...#..................
................#...............#..........#............##.........................#........#.#...............#...##...............
........#..................#..#.....#.#.........#.....#.#.#..................#.......#.#......#....#.........#..#.........#...#....
..#...........##...............#...........#..#...#...#.#..................##......#.....#.......#........#..#...#......#........#.
...................................................................................................................................
`;
        const grid = gridString.split('\n');

        // Function to draw the initial grid
        function drawGrid() {
            for (let y = 0; y < grid.length; y++) {
                for (let x = 0; x < grid[y].length; x++) {
                    if (grid[y][x] === '#') {
                        ctx.fillStyle = 'green';
                        for (let yg = 0; yg < (size/131); yg++) {
                            for (let xg = 0; xg < (size/131); xg++) {
                                const xoffset = (131 * xg)
                                const yoffset = (131 * yg)
                                ctx.fillRect(x + xoffset, y + yoffset, 1, 1);
                            }
                        }
                    }
                }
            }
        }

        // Initialize with a single black pixel at given coordinates
        function init(startX, startY) {
            pixels.add(`${startX},${startY}`);
            drawGrid();
            drawPixels();
        }

        function reset_grid() {
            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, size, size);
        }

        // Draw the pixels on the canvas
        function drawPixels(fillStyle='black') {
            ctx.fillStyle = fillStyle;
            pixels.forEach(p => {
                const [x, y] = p.split(',').map(Number);
                ctx.fillRect(x, y, 1, 1);
            });
            stepcounttext.innerText = stepnum;

        }

        function wrapBy(x, by) {
            return x%by
        }

        // Update the set of pixels
        function updatePixels() {
            let newPixels = new Set();

            pixels.forEach(p => {
                const [x, y] = p.split(',').map(Number);
                if (grid[wrapBy(y,131)][wrapBy((x - 1),131)] === '.') newPixels.add(`${x - 1},${y}`);
                if (grid[wrapBy(y,131)][wrapBy((x + 1),131)] === '.') newPixels.add(`${x + 1},${y}`);
                if (grid[wrapBy((y - 1),131)][wrapBy(x,131)] === '.') newPixels.add(`${x},${y - 1}`);
                if (grid[wrapBy((y + 1),131)][wrapBy(x,131)] === '.') newPixels.add(`${x},${y + 1}`);
            });
            stepnum++;
            pixels = newPixels;
        }

        function updateAndDrawPixels() {
            updatePixels();
            drawAll();
        }

        function drawAll() {
            reset_grid();
            drawGrid();
            drawPixels();
        }

        document.getElementById('expandButton').addEventListener('click', updateAndDrawPixels);

        // Starting coordinates for the black pixel
        const startX = 65 + (131*4); // Example X coordinate
        const startY = 65 + (131*4); // Example Y coordinate
        init(startX, startY); // Initialize the canvas
    </script>
</body>

</html>